# AUTH_GUARD.md (OpenAPI 기준 수정본)  

## 0. 목적

* 페이지 진입 시 사용자의 인증 상태에 따라 접근 가능 여부를 판단한다.
* 모든 페이지에서 동일한 기준을 사용하도록 접근 제어 로직을 공통화한다.
* 페이지 MD에 인증 분기 로직을 중복 작성하지 않기 위함이다.

---

## 1. 인증 상태 정의

### 1.1 로그인 상태

* 서버 인증 확인 API 호출이 성공한 상태
* 인증이 필요한 요청에서 서버가 로그인 사용자로 판단하는 상태

### 1.2 비로그인 상태

* 인증 확인 API 호출 실패
* 인증이 필요한 요청에서 서버가 비로그인으로 판단하는 상태

---

## 2. 인증 상태 판정 방식

### 2.1 판정 기준

* 프론트엔드는 인증 상태를 “로컬 저장값”으로 판정하지 않는다.
* 로그인 상태 판정은 **서버 응답으로만** 결정한다.

### 2.2 판정 방법 (단일 진실)

* 인증 확인 API 호출:

  * `GET /api/v1/members/me`

### 2.3 요청 조건

* 인증 확인 요청은 `credentials: include`를 사용한다.

---

## 3. 페이지 접근 유형 분류

### 3.1 공개 페이지 (Public)

* 로그인 여부와 관계없이 접근 가능
* 예:

  * 메인(`/`)
  * 목록/상세(`/posts`, `/posts/[id]`, `/auctions`, `/auctions/[id]`)

### 3.2 비로그인 전용 페이지 (Guest Only)

* 비로그인 사용자만 접근 가능
* 로그인 상태 접근 시 리다이렉트
* 예:

  * 로그인(`/login`)
  * 회원가입(`/signup`)

### 3.3 로그인 필수 페이지 (Protected)

* 로그인 사용자만 접근 가능
* 비로그인 접근 시 리다이렉트
* 예:

  * 중고거래 작성(`/posts/write`)
  * 경매 작성(`/auctions/write`)
  * 채팅(`/chat`)
  * 마이페이지(`/mypage`)

---

## 4. 접근 제어 규칙

### 4.1 Guest Only 규칙

* 로그인 상태 → 접근 불가
* 처리:

  * 메인(`/`)로 즉시 이동

### 4.2 Protected 규칙

* 비로그인 상태 → 접근 불가
* 처리:

  * 로그인(`/login`)으로 즉시 이동

### 4.3 Public 규칙

* 접근 제어 없음

---

## 5. 실행 시점

* 페이지 최초 진입
* (권장) 레이아웃 마운트 시 1회